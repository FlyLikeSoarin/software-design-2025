@startuml
skinparam shadowing false
skinparam dpi 150

' ---- Пулы как дорожки (swimlanes) ----
|Dealer / Дилер|
start
:Сформировать заказ;
:Отправить заказ в ERP/MES;

|ERP / MES|
:Получить заказ;
:Сформировать производственный план;
:Передать план на завод;

|Завод / Производство|
:Получить план производства;
:Сборка кузова;
:Покраска;
:Сборка агрегатов;
:Передать авто в QC;

|QC / Отдел контроля качества|
:Стендовые и ходовые испытания;
if (Обнаружен дефект?) then (да)
  |Система учёта дефектов|
  :Зарегистрировать дефект;
  :Создать RepairTask (Planned);

  |Диспетчер|
  :Проверить свободные зоны/места;
  if (Есть свободное место?) then (да)
    :Выбрать зону и место;
  else (нет)
    :Поставить авто в очередь;
  endif

  label REPAIR_LOOP
  |Бригадир ремонтной зоны|
  :Назначить ремонт конкретному работнику;

  |Ремонтник|
  :Отметить доступность (check-in);
  :Принять задание;
  :Выполнить ремонт;
  :Завершить ремонт;

  |Система учёта дефектов|
  :Зафиксировать start/end и освободить место;
  :Статус Defect = FixedPendingQC;

  |QC / Отдел контроля качества|
  :Повторные испытания;
  if (Ремонт успешен?) then (да)
    |Система учёта дефектов|
    :Закрыть Defect;
  else (нет)
    |Система учёта дефектов|
    :Открыть/переоткрыть RepairTask;
    -> REPAIR_LOOP
  endif
else (нет)
  :Подтвердить успешное прохождение QC;
endif

|Завод / Производство|
:Передать автомобиль на отгрузку;

|ERP / MES|
:Зафиксировать выпуск;
:Уведомить дилера о готовности;

|Dealer / Дилер|
:Получить уведомление;
stop
@enduml